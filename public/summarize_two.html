<!doctype html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
        <link rel="stylesheet" href="styles/style.css">
        <link rel="stylesheet" href="styles/info_bar.css">
        <title>Abstract Summarization</title>

        <script type="text/javascript">
            window.onload = async function () {
                if (!sessionStorage.getItem('workerNumber')) {
                    try {
                        const response = await fetch("https://detectllmuse-backend.onrender.com/api/worker/number", {
                            method: 'GET',
                        });
                        if (!response.ok) throw new Error(`HTTP error, status ${response.status}`);
                        const data = await response.json();
                        sessionStorage.setItem('workerNumber', data.worker_number);
                        console.log(`Set worker number: ${data.worker_number}`);
                    } catch (error) {
                        console.log("Error fetching worker number:", error);
                    }
                }
            }
        </script>
    </head>
    <body>
        <div class="container">
            <div class="sidebar_container">
                <div class="sidebar">
                    <div class="line"></div>
                    <div>
                        <p class="inactive">1</p>
                        <p class="inactive">2</p>
                        <p class="inactive">3</p>
                        <p class="active">4</p>
                        <p class="inactive">5</p>
                    </div>
                </div>
            </div>
            <div class="container_body">
                <button class="info_button" onclick="openInfo()">?</button>
                <div class="info_bar" id="info_bar">
                    <a href="javascript:void(0)" class="close_info" onclick="closeInfo()">&times;</a>
                    <div style="font-size: 12px;" class="info_text">
                        <h2>Task Description</h2>
                        <p>You are participating in a research study that evaluates summaries of research abstracts...</p>
                        </div>
                </div>

                <h1>Summarization Task 2</h1>
                <p>
                    For this page, we provide you an abstract for you to read. After reading the abstract, please summarize the abstract
                    in the text box. Your summary should be 2-4 sentences in length. Once finished, click 'Next Page'.
                </p>

                <div class="summarization">
                    <div class="abstract" inert>
                        <h2> Abstract </h2>
                        <p>
                            The Asch conformity experiments, conducted by Solomon Asch in the 1950s, explored the impact of social 
                            pressure on individual beliefs and behaviors...
                        </p>
                        <p><b>Reference</b></p>
                        <p>M. Ruth, “Asch conformity experiments.” EBSCO, 2024.</p>
                    </div>
                    <div class="sample_summary"> 
                        <h2> Summary </h2>
                        <textarea id="summaryTwoInput" rows="6" cols="180" class="input_summary" onselectstart="return false" onPaste="return false;" onCopy="return false" onCut="return false" onDrag="return false" onDrop="return false" autocomplete=off></textarea>
                    </div>
                </div>
                
                <button class="next_button" onclick="submit()">Next Page</button>

                <div id="detectionModal" class="modal">
                    <div class="modal-content">
                      <span class="close-modal" onclick="closePopup()">&times;</span>
                      <h2>A Quick Reminder</h2>
                      <p>We noticed your summary is very similar to existing AI-generated patterns.</p>
                      <p>While AI tools are allowed, our research values your own words and ideas more highly. You may revise if you wish.</p>
                      <button class="modal-button" onclick="closePopup()">Continue Writing</button>
                    </div>
                </div>
            </div>
        </div>

        <script src="detection/detection.js"></script>
        <script src="detection/behavior/wpm.js"></script>
        <script src="/detection/behavior/tabSwitch.js"></script>
        <script src="detection/behavior/pause.js"></script>
        <script src="detection/behavior/backspace.js"></script>

        <script>
            setupDetection("summaryTwoInput", "summary2");

            function submit() {
                const summarization = document.getElementById("summaryTwoInput").value;
                const workerNum = sessionStorage.getItem('workerNumber');

                if (!summarization.trim()) {
                    alert("Please write a summary before proceeding.");
                    return;
                }

                const responseData = {
                    "worker_number": Number(workerNum),
                    "task": "task_two",
                    "number_popups": 7,
                    "response": summarization
                };

                const postUrl = "https://detectllmuse-backend.onrender.com/api/response/add";

                fetch(postUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(responseData),
                })
                .then(response => {
                    if (!response.ok) throw new Error('Network response error: ' + response.statusText);
                    return response.json();
                })
                .then(data => {
                    console.log('Success:', data);
                    window.location.href = "/survey";
                })
                .catch((error) => {
                    console.error('Error submitting Task 2:', error);
                    alert('Submission failed. Please try again.');
                });
            }

            function openInfo() {document.getElementById("info_bar").style.width = "500px";}
            function closeInfo() {document.getElementById("info_bar").style.width = "0";} 

            document.addEventListener("copy", (e) => e.preventDefault());
            document.addEventListener("paste", (e) => e.preventDefault());
            document.addEventListener("cut", (e) => e.preventDefault());
            document.addEventListener("contextmenu", (e) => e.preventDefault());
        </script>
    </body>
</html>