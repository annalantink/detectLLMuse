<!doctype html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
        <link rel="stylesheet" href="styles/style.css">
        <link rel="stylesheet" href="styles/info_bar.css">
        <title>Abstract Summarization</title>

        <script type="text/javascript">
            window.onload = async function () {
                try {
                    const response = await fetch("https://detectllmuse-backend.onrender.com/api/worker/number", {
                        method: 'GET',
                    });
                    if (!response.ok) {
                        throw new Error(`HTTP error, status ${response.status}`)
                    }
                    const data = await response.json();
                    const number = data.worker_number;
                    sessionStorage.setItem('workerNumber', number);
                    console.log(`Set number ${sessionStorage.getItem('workerNumber')}`)
                } catch (error) {
                    console.log(error);
                }
            }
        </script>
    </head>
    <body id="doc_body">
        <div class="container">
            <div class="sidebar_container">
                <div class="sidebar">
                    <div class="line"></div>
                    <div>
                        <p class="inactive">1</p>
                        <p class="inactive">2</p>
                        <p class="active">3</p>
                        <p class="inactive">4</p>
                        <p class="inactive">5</p>
                    </div>
                </div>
            </div>
            <div class="container_body">
                <button class="info_button" onclick="openInfo()">?</button>
                <div class="info_bar" id="info_bar">
                    <a href="javascript:void(0)" class="close_info" onclick="closeInfo()">&times;</a>
                    <div style="font-size: 12px;" class="info_text">
                        <h2>Task Description</h2>
                        <p> 
                            You are participating in a research study that evaluates summaries of research abstracts. 
                            This study is being done by a research group consisting of masters students from the TU Delft.
                        </p>
                        </div>
                </div>

                <h1>Summarization Task 1</h1>
                <p>
                    For this page, we provide you an abstract for you to read. After reading the abstract, please summarize the abstract
                    in the text box. Your summary should be 2-4 sentences in length. Once finished, click 'Next Page'.
                </p>
                
                <div class="summarization">
                    <div class="abstract" inert>
                        <h2> Abstract </h2>
                        <p>
                            This research provides evidence that people overestimate the extent to which their actions and appearance 
                            are noted by others, a phenomenon dubbed the spotlight effect...
                        </p>
                        <p><b>Reference</b></p>
                        <p>T. Gilovich, V. H. Medvec, and K. Savitsky, 2000.</p>
                    </div>
                    <div class="sample_summary"> 
                        <h2> Summary </h2>
                        <textarea id="summaryOneInput" rows="6" cols="180" class="input_summary" onselectstart="return false" onPaste="return false;" onCopy="return false" onCut="return false" onDrag="return false" onDrop="return false" autocomplete=off></textarea>
                    </div>
                </div>
                
                <button class="next_button" onclick="submit()">Next Page</button>
            </div>
        </div>

        <script>
            if (typeof setupDetection === "function") {
                setupDetection("summaryOneInput", "summary1");
            }

            function submit() {
                const summarization = document.getElementById("summaryOneInput").value;
                const workerNum = sessionStorage.getItem('workerNumber');
                console.log(workerNum);

                const responseData = {
                    "worker_number": Number(workerNum),
                    "task": "task_one",
                    "number_popups": 7, 
                    "response": summarization
                };

                const postUrl = "http://localhost:8080/api/response/add";

                fetch(postUrl, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(responseData),
                })
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Network response was not ok: ' + response.statusText);
                    }
                    return response.json();
                })
                .then(data => {
                    console.log('Success:', data);
                    window.location.href = "/summarize_two";
                })
                .catch((error) => {
                    console.error('Error submitting form:', error);
                    alert('An error occurred during submission. Please try again.');
                });
            }

            function openInfo() {document.getElementById("info_bar").style.width = "500px";}
            function closeInfo() {document.getElementById("info_bar").style.width = "0";} 

            document.addEventListener("copy", function(e) {e.preventDefault();});
            document.addEventListener("paste", function(e) {e.preventDefault();});
            document.addEventListener("cut", function(e) {e.preventDefault();});
            document.addEventListener("contextmenu", function(e) {e.preventDefault();});
        </script>
    </body>
</html>